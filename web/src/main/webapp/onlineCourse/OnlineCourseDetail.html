<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oxygen:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery.smartmenus/1.1.0/jquery.smartmenus.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery.smartmenus/1.1.0/addons/bootstrap/jquery.smartmenus.bootstrap.min.js'></script>
    <style>
        .add-to-cart-button {
            background: #e6a247;
            border: none;
            border-radius: 4px;
            -webkit-box-shadow: 0 3px 13px -2px rgba(0, 0, 0, .15);
            box-shadow: 0 3px 13px -2px rgba(0, 0, 0, .15);
            color: #ffffff;
            display: flex;
            font-family: 'Ubuntu', sans-serif;
            justify-content: space-around;
            min-width: 195px;
            overflow: hidden;
            outline: none;
            padding: 0.7rem;
            position: relative;
            text-transform: uppercase;
            transition: 0.4s ease;
            width: auto;

        }

        .add-to-cart,
        .added-to-cart {
            margin-left: 36px;
        }

        .added-to-cart {
            display: none;
            position: relative;
        }

        .add-to-cart-box {
            height: 5px;
            position: absolute;
            top: 0;
            width: 5px;
        }

        .box-1,
        .box-2 {
            transition: 0.4s ease;
            top: -8px;
        }

        .box-1 {
            left: 23px;
            transform: rotate(45deg);
        }

        .box-2 {
            left: 32px;
            transform: rotate(63deg);
        }

        .cart-icon {
            left: 15px;
            position: absolute;
            top: 8px;
        }

        .tick {
            background: #146230;
            border-radius: 50%;
            position: absolute;
            left: 28px;
            transform: scale(0);
            top: 5px;
            z-index: 2;
        }

        @-webkit-keyframes grow {
            0% {
                -webkit-transform: scale(0);
            }

            50% {
                -webkit-transform: scale(1.2);
            }

            100% {
                -webkit-transform: scale(1);
            }
        }

        @keyframes grow {
            0% {
                transform: scale(0);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        @-webkit-keyframes drop {
            0% {
                -webkit-transform: translateY(0px);
            }

            100% {
                -webkit-transform: translateY(1px);
            }
        }

        @keyframes drop {
            0% {
                transform: translateY(0px);
            }

            100% {
                transform: translateY(1px);
            }
        }

        .flexbox{
        display:flex;
        gap:25px;
        box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.2);
        border-radius:10px;
        padding:20px;
      align-self: center;
      margin-bottom:20px;
        }
        
        #commentarea{
        	align-self: center;
        	
        }
        
        #comments-list {
            list-style-type: none;
        }

        .comments-list {
            margin-top: 30px;
            position: relative;
        }

        .comments-list li {
            margin-bottom: 15px;
            display: block;
            position: relative;
        }

        .comments-list .comment-box {
        	border-style:ridge;
            width: 680px;
            float: right;
            position: relative;
            -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
            -moz-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
        }

        .comment-box .comment-head {
            background: #FCFCFC;
            padding: 10px 12px;
            border-bottom: 1px solid #E5E5E5;
            overflow: hidden;
            -webkit-border-radius: 4px 4px 0 0;
            -moz-border-radius: 4px 4px 0 0;
            border-radius: 4px 4px 0 0;
        }

        .comment-box .comment-name {
            color: #03658c;
            font-size: 14px;
            font-weight: 700;
            margin-right: 10px;
        }

        .comment-box span {
            float: left;
            color: #999;
            font-size: 13px;
            position: relative;
            top: 1px;
        }

        .comment-box .comment-content {
            background: #FFF;
            padding: 12px;
            font-size: 15px;
            color: #595959;
            -webkit-border-radius: 0 0 4px 4px;
            -moz-border-radius: 0 0 4px 4px;
            border-radius: 0 0 4px 4px;
        }

        .comment-box .comment-name.by-author:after {
            background: #03658c;
            color: #FFF;
            font-size: 12px;
            padding: 3px 5px;
            font-weight: 700;
            margin-left: 10px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
        }

        @media only screen and (max-width: 766px) {
            .comments-container {
                width: 480px;
            }

            .comments-list .comment-box {
                width: 390px;
            }

            .reply-list .comment-box {
                width: 320px;
            }
        }
    </style>




</head>

<body bgcolor='white'>
   <!-- Navbar Start -->
	<nav class="navbar navbar-expand-lg bg-light">
		<div class="container-fluid">
			<!-- LOGO -->
			<a class="navbar-brand" href="${ctxPath}/index.jsp"> 
				<img src="${ctxPath}/css/LOGO.png" alt="Logo" width="80" height="90">
			</a>
			<!-- 螢幕縮小時導覽列會縮小成右上按鈕點開會直向呈現 -->
			<button class="navbar-toggler" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
				aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<!-- collapse：無論任何螢幕大小，你都不會看到有選單在頂部。 -->
			<!-- nav-collapse：當螢幕變小時，選單會改為直行顯示。 -->
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav me-auto mb-2 mb-lg-0">
					<li class="nav-item">
						<a class="nav-link active" aria-current="page" href="${pageContext.request.contextPath}/latest_news/select_page.jsp">最新消息</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">好食產品專區</a>
							<ul class="dropdown-menu">
								<li>
                  					<a class="dropdown-item" href="${ctxPath}/meal/mealController?action=listAll">產品清單</a>
               	 				</li>
                				<li>
                 		     		<a class="dropdown-item" href="${ctxPath}/meal/RandomAssign.jsp">隨機配餐</a>
      				            </li>
                				<li>
                  					<a class="dropdown-item" href="${ctxPath}/cart/MealCart.jsp">商品購物車</a>
               					</li>
							</ul>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">課程專區</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="${pageContext.request.contextPath}/onlineCourse/ListAllOnlineCourse.jsp">線上課程專區</a></li>
								<li><a class="dropdown-item" href="${ctxPath}/cart/OnlineCourseCart.jsp">線上課程購物車</a></li>
								<li><a class="dropdown-item" href="">實體課程專區</a></li>
							</ul>
					</li>
					<li class="nav-item">
						<a class="nav-link active" aria-current="page" href="<%=request.getContextPath()%>/forum_article/forum_article_select_page.jsp">康健新知論壇</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="<%=request.getContextPath()%>/faqservlet?action=getAll" role="button" data-bs-toggle="dropdown" aria-expanded="false">FAQ及客服專區</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="<%=request.getContextPath()%>/faqservlet?action=getAll">FAQ</a></li>
								<li><a class="dropdown-item" href="<%=request.getContextPath()%>/customerServiceServlet?action=getConnection">線上客服</a></li>
							</ul>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="" role="button" data-bs-toggle="dropdown" aria-expanded="false">會員專區</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="">個人資料管理</a></li>	
								<li class="dropdown-submenu">
									<a class="dropdown-item">訂單管理&emsp;></a>
									<ul class="dropdown-menu">
										<li><a class="dropdown-item" href="${ctxPath}/order/orderController?action=orderList">商品訂單</a></li>
										<li><a class="dropdown-item" href="${pageContext.request.contextPath}/onlineCourseOrderServlet?action=orderlist">線上課程訂單</a></li>
									</ul>
								</li>
								<li><a class="dropdown-item">我的課程&emsp;></a>
									<ul class="dropdown-menu">
										<li><a class="dropdown-item" href="${pageContext.request.contextPath}/onlineCourse/ManageCourse.jsp">線上課程</a></li>
										<li><a class="dropdown-item" href="">實體課程</a></li>
									</ul>
								</li>
								<li>
                  					<a class="dropdown-item" href="${ctxPath}/mealCollect/list">我的收藏</a>
                				</li>
                				<li><a class="dropdown-item">我的評價&emsp;></a>
									<ul class="dropdown-menu">
										<li><a class="dropdown-item" href="<%=request.getContextPath()%>/MemberOnlineCourseCommentServlet?action=getMember_For_Display">線上課程</a></li>
										<li><a class="dropdown-item" href="<%=request.getContextPath()%>/phyCourseComment?action=getMember_For_Display">實體課程</a></li>
									</ul>
								</li>
							</ul>
					</li>
					&emsp;
					<li class="nav-item">
						<a class="nav-link active" aria-current="page" href="${ctxPath}/cart/MealCart.jsp">商品購物車<c:if test="${not empty cartProds}"> (${fn:length(cartProds)})</c:if></a>
					</li>
					&emsp;
					<li class="nav-item">
						<a class="nav-link active" aria-current="page" href="${ctxPath}/cart/OnlineCourseCart.jsp">線上課程購物車<c:if test="${not empty cartCourses}"> (${fn:length(cartCourses)})</c:if></a>
					</li>
					&emsp;
					<c:if test="${not empty member}">
					<li class="nav-item">
						Hello!
						${member.memberAccount}
						&emsp;
						<button id="outbutton">
							<a href="<%=request.getContextPath()%>/member/MemberServlet?action=Logout" style="display:inline-block; text-decoration:none;color:black;">登出</a>
						</button>
					</li>
					</c:if>
					<c:if test="${empty member}">
					<li class="nav-item">
						&emsp;
						${Guest}
						<button id="inbutton">
							<a href="${ctxPath}/member/login.jsp" style="display:inline-block; text-decoration:none;color:black;"> 登入 | 註冊</a>
						</button>
					</li>
					</c:if>
				</ul>
			</div>
		</div>
	</nav>
	<!-- Navbar End -->
	
    <div id="cardWrapper">

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const cardWrapper = document.querySelector('#cardWrapper');
        const id = sessionStorage.getItem('courseNo');
        const url = '../onlineCourse/detail?courseNo=' + id;
        fetch(url)
            .then(resp => resp.json())
            .then(onlineCourse => {
                const [course, comment] = onlineCourse;
                cardWrapper.insertAdjacentHTML('beforeend', `
 					<div style="display:flex;flex-direction:column;justify-content:center">
                		<div class="flexbox">
 							<div>
 								<img src="data:image/png;base64,${course.onlineCoursePhotoBaseStr64}">
 							</div>
 							<div>
	 							<div>
	 								<b>線上課程編號</b> :${course.courseNo}<br><br>
	 								<b>線上課程名稱</b> :${course.courseName}<br><br>
	 								<b>線上課程價格</b> : ${course.coursePrice}<br><br>
	 								<b>線上課程時數</b> :${course.courseHr}<br><br>
	 								<b>線上課程老師</b> :${course.courseTeacher}<br><br>
	 								<b>線上課程資訊</b> :${course.courseInfo}<br><br>
	 								<b>線上課程評論人數</b> : ${comment.length}<br><br>
	 								<b id="score">線上課程評論分數 : </b><br><br>
	 								
	 							</div>
	 							
	 							<div style="display:flex;gap:10px;">
 									<form method="get" action="../cart/cartCourseController">
 										<input type="hidden" name="courseNo" value="${course.courseNo}">
                                		<input type="hidden" name="action" value="cartAdd">
                                		
                                			<button class="add-to-cart-button">
                                     			<svg class="add-to-cart-box box-1" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="2" fill="#ffffff"/></svg>
                                     			<svg class="add-to-cart-box box-2" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="2" fill="#ffffff"/></svg>
                                     			<svg class="cart-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                                     			<svg class="tick" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="#ffffff" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.29 16.29L5.7 12.7c-.39-.39-.39-1.02 0-1.41.39-.39 1.02-.39 1.41 0L10 14.17l6.88-6.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-7.59 7.59c-.38.39-1.02.39-1.41 0z"/></svg>
                                     			<span class="add-to-cart">加入購物車</span>                           		
                                 			</button>
                                 	
                            		</form>
                            		<form method="get" action="../cart/cartCourseController">
 										<input type="hidden" name="courseNo" value="${course.courseNo}">
                                		<input type="hidden" name="action" value="oneCartAdd">
                                
                             				<button class="add-to-cart-button">
                                				<i class="bi bi-credit-card-2-back"></i>
                                				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-credit-card-2-back" viewBox="0 0 16 16">
                                				<path d="M11 5.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1z"/>
                                				<path d="M2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2zm13 2v5H1V4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1zm-1 9H2a1 1 0 0 1-1-1v-1h14v1a1 1 0 0 1-1 1z"/>
                                				</svg>
                                				<span class="add-to-cart">直接結帳</span>   
                            				</button>
                            		
                            		</form>
								</div>
							</div>
						</div>
						<div id="commentarea" class="comments-container">
							<ul id="comments-list" class="comments-list">
							</ul>
						</div>
 						</div>`)
                getComment(comment);
            });
        // coursePhoto
		var sum=0;
        function getComment(list) {
            const commentarea = document.querySelector('#comments-list');
            commentarea.innerHTML = '評論專區<br>';
            const score = document.querySelector('#score');
            if (list.length == 0) {
                commentarea.innerHTML = '評論專區<br>尚無評價';
                score.insertAdjacentHTML('beforeend',"0 / 10");
            }
            for (comment of list) {
            	sum+=comment.commentScore;
                commentarea.insertAdjacentHTML('beforeend', `
                            <li>
                                <div class="comment-main-level">
                                	<form action="../onlinecoursecommentreport/addOnlineCourseCommentReport.jsp">
                                    <div class="comment-box">
                                        <div class="comment-head" style="display:flex;justify-content:Space-between;align-item:center;">
                                            <div><h6 class="comment-name">評論分數:${comment.commentScore}</h6></div>                                         
                                            <div>
                                            <span>commentNo.${comment.commentNo}</span>
                                            &emsp;
                                            <input type="hidden" name="commentNo" value="${comment.commentNo}">
                    						<input type="submit" value="我要檢舉" style="border-radius:1rem;border: 1px solid #ccc;">
                    						</div>
                                        </div>
                                        <div class="comment-content">${comment.commentContent}
                                        <br>
                                        <span>memID.${comment.memberNo}</span>
                                        </div>
                                    </div> 
            						</form>
                                </div>
                            </li>
					`)
            }
            var avg=(sum/list.length).toFixed(1);
            if(isNaN(avg)){
            }else{
            	score.insertAdjacentHTML('beforeend',avg+" / 10");
            }
        }

        addToCartButton = document.querySelectorAll(".add-to-cart-button");

        document.querySelectorAll('.add-to-cart-button').forEach(function (addToCartButton) {
            addToCartButton.addEventListener('click', function () {
                addToCartButton.classList.add('added');
                setTimeout(function () {
                    addToCartButton.classList.remove('added');
                }, 2000);
            });
        });
        	
	</script>
</body>

</html>